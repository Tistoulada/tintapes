<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>TinTapes</title>
  <style>
    :root{ --fs: 2.8vw; --lh: 1.08; }
    @media (max-width: 700px){ :root{ --fs: 4.8vw; --lh: 1.04; } } /* cassette visible en entier sur mobile */

    html,body{
      margin:0; min-height:100%;
      background:#000; color:#fff;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono","Courier New", monospace;
      display:flex; align-items:center; justify-content:center;
    }
    .stage{ position:relative; }
    pre#art{
      margin:0; white-space:pre; text-align:center;
      font-size: var(--fs); line-height: var(--lh);
    }

    /* champs réels (positionnés au pixel) */
    #codeInput, #enterBtn{
      position:absolute; z-index:10; font:inherit; pointer-events:auto;
    }
    #codeInput{
      background:#111; color:#fff; border:1px solid #444;
      padding:.28rem .48rem; text-align:center; box-sizing:border-box;
      font-size: clamp(14px,1.05rem,4.2vw);
    }
    #codeInput::placeholder{ color:transparent; } /* pas de texte fantôme */
    #enterBtn{
      background:#222; color:#fff; border:1px solid #444;
      padding:.28rem .52rem; cursor:pointer; white-space:nowrap;
      font-size: clamp(14px,1rem,4.2vw);
    }
  </style>
</head>
<body>
  <div class="stage" id="stage">
<pre id="art">
┌────────────────────────────┐
│                            │
│         TIN TAPES          │
│      ╔════════════╗        │
│  <span id="wL">⟳</span> ║ <span id="tapeL">░░░░░░░░░░░░</span><span id="tapeGap">  </span><span id="tapeR">░░</span> ║ <span id="wR">⟳</span>  │
│      ╚════════════╝        │
│                            │
│    4 TRACKS // ONE TAKE    │
│         INSERT CODE        │
│      <span id="slot-start">[</span><span id="slot">______________</span><span id="slot-end">]</span>      │
└────────────────────────────┘
</pre>

    <!-- champs réels -->
    <input id="codeInput" autocomplete="off" autocapitalize="characters" spellcheck="false" />
    <button id="enterBtn">ENTER</button>
  </div>

  <script>
    /* === Codes -> pages === */
    function checkCode(){
      const code = document.getElementById('codeInput').value.trim().toUpperCase();
      const map = {
        "TT-KAL": "code/kalupto.html",
        "TT-BST": "code/boost.html",
        "TT-SWK": "code/superweekend.html",
        "TT-BRI": "code/brie.html",
        "TT-GST": "code/guest.html"
      };
      if(map[code]) location.href = map[code]; else alert("Invalid code.");
    }
    const inputEl = document.getElementById('codeInput');
    document.getElementById('enterBtn').addEventListener('click', checkCode);
    inputEl.addEventListener('keydown', e=>{ if(e.key==='Enter') checkCode(); });

    /* === Placement robuste: mesuré entre [ et ] + recalcul auto === */
    const stage   = document.getElementById('stage');
    const slotL   = document.getElementById('slot-start'); // '['
    const slotR   = document.getElementById('slot-end');   // ']'
    const btnEl   = document.getElementById('enterBtn');

    function placeControls(){
      const s  = stage.getBoundingClientRect();
      const rl = slotL.getBoundingClientRect();
      const rr = slotR.getBoundingClientRect();

      // largeur intérieure exacte entre [ et ], sécurisée par un shrink
      const inner   = Math.max(0, rr.left - rl.right);
      const shrink  = window.matchMedia('(max-width:700px)').matches ? 0.70 : 0.80;
      const width   = Math.max(80, inner * shrink);
      const pad     = (inner - width) / 2;  // centrage parfait

      // position relative au conteneur + centrage vertical sur la ligne
      const centerY = (rl.top + rl.bottom) / 2 - s.top;
      const inputTop = centerY - (inputEl.offsetHeight || 32) / 2; // si pas mesuré, 32px approx

      inputEl.style.width = width + 'px';
      inputEl.style.left  = (rl.right - s.left + pad) + 'px';
      inputEl.style.top   = inputTop + 'px';

      // bouton collé après le ], avec un petit écart qui s'adapte
      const after = window.matchMedia('(min-width:701px)').matches ? 8 : 4;
      const btnTop = centerY - (btnEl.offsetHeight || 28) / 2;
      btnEl.style.left = (rr.right - s.left + after) + 'px';
      btnEl.style.top  = btnTop + 'px';
    }

    // recalcule sur: chargement, resize, rotation, et aussi quand la police/metrics évoluent
    window.addEventListener('load', placeControls);
    window.addEventListener('resize', placeControls);
    window.addEventListener('orientationchange', placeControls);
    new ResizeObserver(placeControls).observe(document.getElementById('art'));

    /* === Animation scroll (roues + bande) === */
    const wL = document.getElementById('wL');
    const wR = document.getElementById('wR');
    const tapeL = document.getElementById('tapeL');
    const tapeR = document.getElementById('tapeR');
    const tapeGap = document.getElementById('tapeGap');

    const wheelFrames = ['⟳','⟲','↺','↻'];
    const TOTAL_TAPE = 18;     // longueur visuelle de bande
    let pos = TOTAL_TAPE - 2;  // départ: surtout à gauche
    let wheel = 0, accum = 0;

    function render(){
      if(pos<0) pos=0; if(pos>TOTAL_TAPE) pos=TOTAL_TAPE;
      tapeL.textContent = '░'.repeat(pos);
      tapeR.textContent = '░'.repeat(TOTAL_TAPE - pos);
      tapeGap.textContent = '  ';
      wL.textContent = wheelFrames[(wheel) % wheelFrames.length];
      wR.textContent = wheelFrames[(wheel+2) % wheelFrames.length];
      placeControls(); // recale si la taille visuelle a bougé
    }

    window.addEventListener('wheel', e=>{
      accum += Math.abs(e.deltaY);
      const threshold = 50; // ↑ augmente pour demander plus de scroll
      if(accum > threshold){
        const step = e.deltaY > 0 ? 1 : -1;
        pos += step;
        wheel = (wheel + step + 1000) % 1000;
        accum = 0;
        render();
      }
    }, {passive:true});

    render();
  </script>
</body>
</html>



